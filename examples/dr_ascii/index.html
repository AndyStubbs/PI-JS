<!DOCTYPE html>
<html>
    <head>
        <title>Dr. Ascii</title>
        <script src="../../build/qbs.js"></script>
        <style>
            html, body {
                background-color: black;
            }
        </style>
    </head>
<body>
<script>
"use strict";

var bottle = `
12345678901234567890123456789012

           ÉÍÍÍÍÍÍÍ»
           º       º
           ÈÍ»   ÉÍ¼
             º   º
             º   º
          ÉÍÍ¼   ÈÍÍ»
          º         º
          º         º
          º         º
          º         º
          º         º
          º         º
          º         º
          º         º
          º         º
          º         º
          º         º
          º         º
          º         º
          º         º
          º         º
          º         º
          º         º
          ÈÍÍÍÍÍÍÍÍÍ¼
`;

var g = {
    "cnt": 0,
    "cnt2": 0,
    "interval": 0,
    "top": 1000,
    "viruses": [ "~!", "@#", "$%" ],
    "game": {
        "players": 1,
        "level": 3,
        "speed": "MED",
        "virus": 4,
        "score": 0,
        "viruses": [
            { "x": 15, "y": 12, "c": 4, "id": 0, "frame": 0 }
        ],
        "pills": [
            { "x": 15, "y": 15, "c": 54, "id": "(" },
            { "x": 16, "y": 15, "c": 44, "id": ")" }
        ]
    },
    "screens": []
};

initGame();

function initGame() {
    var i;

    g.screens.push( $.screen( "256x224" ) );
    g.screens.push( $.screen( "10x10" ) );

    // Viruses
    for( i = 0; i < g.screens.length; i++ ) {
        $.setScreen( g.screens[ i ] );
        $.setFont( 2 );
        $.setChar( "~", "00c33c4299663c42" );   // A0
        $.setChar( "!", "81423c425ae73c24" );   // A1
        $.setChar( "@", "005a3c5aff663c42" );   // B0
        $.setChar( "#", "00187e5a7ee73c24" );   // B1
        $.setChar( "$", "c3ff425a7ec35a66" );   // C0
        $.setChar( "%", "00ffc35aff427ee7" );   // C1
    }

    $.setScreen( g.screens[ 0 ] );

    // Pills
    $.setChar( "(", "3f7fffffffff7f3f" );   // Left
    $.setChar( ")", "fcfefffffffffefc" );   // Right
    $.setChar( "-", "3c7effffffffffff" );   // Top
    $.setChar( "_", "ffffffffffff7e3c" );   // Bottom
    $.setChar( "&", "3c7effffffff7e3c" );   // Circle

    drawGameScreen();
}


function showIntroScreen() {
	var cols, rows, x, y, centerX, centerY, step, steps;

    $.onkey( "1", "up", startGame );
    $.onkey( "2", "up", startGame );
    animateIntro();
    g.interval = setInterval( animateIntro, 60 );
}

function animateIntro() {
    cols = $.getCols();
    rows = $.getRows();

    centerX = Math.round( cols / 2 );
    centerY = Math.round( rows / 2 ) - 1
    
    $.cls();
    $.setColor( 15 );
    $.setPos( 0, centerY - 1 );    
    $.print( "Dr. Ascii", true, true );
    $.print( "\n" );
    $.print( "1 or 2 players?", true, true );
    if( g.cnt2 < 5 ) {
        $.print( "_", true );        
    }

    $.setColor( 4 );
    
    x = centerX - 15;
    y = centerY - 5;
    step = 0;
    steps = 74;
    while( step < steps ) {
        if( step < 27 ) {
            x += 1;
        } else if( step < 37 ) {
            y += 1;
        } else if( step < 64 ) {
            x -= 1;
        } else {
            y -= 1;
        }
        $.setPos( x, y );
        if( step % 3 === g.cnt ) {
            $.print( "*", true );
        }
        step += 1;
    }

    g.cnt = ( g.cnt + 1 ) % 3;
    g.cnt2 = ( g.cnt2 + 1 ) % 10;
    //requestAnimationFrame( animateIntro );
}

function startGame( key ) {
    $.clearKeys();
    clearInterval( g.interval );
    if( key.key === "1" ) {
        g.game.draw = drawGameScreen;
    }
    $.print( key.key );
}

function drawGameScreen() {
    var i, virus, pill;

    $.cls();

    //Draw Bottles
    $.setColor( 7 );
    $.print( bottle );

    // Draw Scores
    $.setColor( 8 );
    $.rect( 4, 22, 65, 43, 7 );
    $.setColor( 16 );
    $.setPos( 0, 3 );
    $.print( " TOP" );

    $.print( " " + $.util.padL( g.top, 7, "0" ) );
    $.print();
    $.print( " SCORE" );
    $.print( " " + $.util.padL( g.game.score, 7, "0" ) );

    // Draw Dr. Ascii
    $.setColor( 7 );
    $.setPos( 22, 3 );
    $.print( "Dr. Ascii" );

    // Draw Stats
    $.setColor( 8 );
    $.rect( 186, 116, 54, 88, 7 );

    // Print Level
    $.setColor( 16 );
    $.setPos( 24, 16 );
    $.print( "LEVEL" );
    $.setPos( 27, 17 );
    $.print( $.util.padL( g.game.level, 2, "0" ) );

    // Print Speed
    $.setPos( 24, 19 );
    $.print( "SPEED" );
    $.setPos( 26, 20 );
    $.print( g.game.speed );

    // Print Virus Count
    $.setPos( 24, 22 );
    $.print( "Virus" );
    $.setPos( 27, 23 );
    $.print(  $.util.padL( g.game.viruses.length, 2, "0" ) );

    // Draw Big Viruses
    $.setColor( 8 );
    $.circle( 35, 150, 33, 7 );
    g.screens[ 1 ].print( "~" );
    $.drawImage( )

    // Draw Viruses
    for( i = 0; i < g.game.viruses.length; i++ ) {
        virus = g.game.viruses[ i ];
        $.setColor( virus.c );
        $.setPos( virus.x, virus.y );
        $.print( g.viruses[ virus.id ].charAt( virus.frame ) );
    }

    // Draw Pills
    for( i = 0; i < g.game.pills.length; i++ ) {
        pill = g.game.pills[ i ];
        $.setColor( pill.c );
        $.setPos( pill.x, pill.y );
        $.print( pill.id );
    }
}
</script>
</body>
</html>
